const fs = require('fs')
const path = require('path')

const run = () => {
  addReviewScript()
  addGitignore()
}

const addReviewScript = () => {
  const pathToFile = path.join(__dirname, '../..', 'package.json')

  fs.readFile(pathToFile, (err, fileContent) => {
    if (err) { throw err }

    fileContent = JSON.parse(fileContent)
    fileContent.scripts.review = "node node_modules/elevation-pr/index.js"
    fileContent = JSON.stringify(fileContent, null, 2)

    fs.writeFile(pathToFile, fileContent, err => {
      if (err) { throw err }
    })
  })
}

const addGitignore = () => {
  const pathToFile = path.join(__dirname, '../..', '.gitignore')

  if (!fs.existsSync(pathToFile)) {
    fs.writeFile(pathToFile, 'node_modules', err => {
      if (err) { throw err }
    })
  }
}

run()